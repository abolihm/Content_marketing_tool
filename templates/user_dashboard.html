<!DOCTYPE html>
<html>
<head>
    <title>{{ selected_user }}'s Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background-color: #f5f5f5;
        }
        .cards {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }
        .card {
            flex: 1;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        .card h2 {
            margin: 0;
            font-size: 32px;
            color: #333;
        }
        .card p {
            margin: 8px 0 0;
            font-size: 16px;
            color: #777;
        }
        .chart-options {
            margin-bottom: 20px;
        }
        .chart-container {
            margin-bottom: 50px;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        th {
            background-color: #f0f0f0;
        }
        a {
            color: #007bff;
        }
    </style>
</head>
<body>

    <h1>{{ selected_user }}'s Dashboard</h1>

    <!-- User Selection Form -->
    <form method="get" style="margin-bottom: 20px;">
        <label for="user"><strong>Select User:</strong></label>
        <select name="user" id="user" onchange="this.form.submit()">
            {% for user in users %}
                <option value="{{ user }}" {% if user == selected_user %}selected{% endif %}>{{ user }}</option>
            {% endfor %}
        </select>
    </form>

    <!-- Summary Cards -->
    <div class="cards">
        <div class="card">
            <h2>{{ total_projects }}</h2>
            <p>Total Projects</p>
        </div>
        <div class="card">
            <h2>{{ allocated_links }}</h2>
            <p>Allocated Links</p>
        </div>
        <div class="card">
            <h2>{{ live_links }}</h2>
            <p>Live Links</p>
        </div>
        <div class="card">
            <h2>{{ pending_links }}</h2>
            <p>Pending Links</p>
        </div>
    </div>

    <!-- Chart Type Selector -->
    <div class="chart-options">
        <label for="chartType"><strong>Choose Chart Type:</strong></label>
        <select id="chartType" onchange="renderChart()">
            <option value="bar">Bar</option>
            <option value="line">Line</option>
            <option value="pie">Pie</option>
        </select>
    </div>

    <!-- ECharts Container -->
    <div class="chart-container">
        <h3>Project Performance</h3>
        <div id="echartContainer" style="height: 400px; width: 100%;"></div>
    </div>

    <!-- Link Table -->
    <h3>Link Details</h3>
    <table>
        <thead>
            <tr>
                <th>Project</th>
                <th>Publication Site</th>
                <th>Month</th>
                <th>Keyword 1</th>
                <th>URL Page 1</th>
                <th>Keyword 2</th>
                <th>URL Page 2</th>
                <th>Status</th>
                <th>Live URL</th>
                <th>Live Date</th>
                <th>Price</th>
                <th>Invoice No.</th>
                <th>Blogger</th>
                <th>Collected</th>
                <th>Payment</th>
            </tr>
        </thead>
        <tbody>
            {% for row in table_data %}
            <tr>
                <td>{{ row.project_name }}</td>
                <td>{{ row.publication_site }}</td>
                <td>{{ row.month }}</td>
                <td>{{ row.keyword_1 }}</td>
                <td><a href="{{ row.url_page_1 }}" target="_blank">{{ row.url_page_1 }}</a></td>
                <td>{{ row.keyword_2 }}</td>
                <td><a href="{{ row.url_page_2 }}" target="_blank">{{ row.url_page_2 }}</a></td>
                <td>{{ row.status }}</td>
                <td><a href="{{ row.live_url }}" target="_blank">{{ row.live_url }}</a></td>
                <td>{{ row.live_url_date }}</td>
                <td>{{ row.price }}</td>
                <td>{{ row.invoice_number }}</td>
                <td>{{ row.blogger_name }}</td>
                <td>{{ row.collected_status }}</td>
                <td>{{ row.payment_status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- ECharts Script -->
    <script>
        const chartData = {
            labels: [{% for row in bar_chart_data %}"{{ row.0 }}",{% endfor %}],
            allocated: [{% for row in bar_chart_data %}{{ row.1 }},{% endfor %}],
            live: [{% for row in bar_chart_data %}{{ row.2 }},{% endfor %}],
            pending: [{% for row in bar_chart_data %}{{ row.3 }},{% endfor %}]
        };

        const chart = echarts.init(document.getElementById('echartContainer'));

        function renderChart() {
            const type = document.getElementById('chartType').value;

            let option = {
                tooltip: { trigger: 'axis' },
                legend: { data: ['Allocated', 'Live', 'Pending'] },
                xAxis: { type: 'category', data: chartData.labels },
                yAxis: { type: 'value' },
                series: []
            };

            if (type === 'bar' || type === 'line') {
                option.series = [
                    { name: 'Allocated', type: type, data: chartData.allocated },
                    { name: 'Live', type: type, data: chartData.live },
                    { name: 'Pending', type: type, data: chartData.pending }
                ];
            } else if (type === 'pie') {
                option = {
                    tooltip: { trigger: 'item' },
                    legend: { top: 'bottom' },
                    series: [{
                        name: 'Total Links',
                        type: 'pie',
                        radius: '50%',
                        data: chartData.labels.map((label, idx) => ({
                            name: label,
                            value: chartData.allocated[idx] + chartData.live[idx] + chartData.pending[idx]
                        }))
                    }]
                };
            }
            chart.setOption(option);
        }

        renderChart(); // Initial chart
    </script>

</body>
</html>
