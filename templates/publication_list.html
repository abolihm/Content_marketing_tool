<!DOCTYPE html>
<html>
<head>
    <title>Publication Sites</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .edit-form { display: none; }
        .edit-icon { cursor: pointer; color: #007bff; }
    </style>
    <script>
        function toggleEdit(id) {
            document.getElementById("display-" + id).style.display = "none";
            document.getElementById("edit-" + id).style.display = "table-row";
        }
    </script>
</head>
<body class="p-4">

    <h2>Publication Sites</h2>

    <!-- Filters -->
    <form method="get" class="mb-3 d-flex gap-2">
        <select name="category" class="form-select w-auto" onchange="this.form.submit()">
            <option value="">-- All Categories --</option>
            {% for c in categories %}
                <option value="{{ c }}" {% if c == selected_category %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>

        <select name="limit" class="form-select w-auto" onchange="this.form.submit()">
            {% for l in limit_options %}
                <option value="{{ l }}" {% if l == selected_limit %}selected{% endif %}>Show {{ l }}</option>
            {% endfor %}
        </select>
    </form>

    <!-- Table -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Domain</th>
                <th>Category</th>
                <th>DR</th>
                <th>DA</th>
                <th>Spam Score</th>
                <th>Similarweb Traffic</th>
                <th>Indian Traffic</th>
                <th>Traffic Graph</th>
                <th>Country</th>
                <th>Index Pages</th>
                <th>HM Score</th>
                <th>Price</th>
                <th>Link Type</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody>
            {% for site in sites %}
            <!-- Display Row -->
            <tr id="display-{{ site.id }}">
                <td>{{ site.domain }}</td>
                <td>{{ site.category }}</td>
                <td>{{ site.dr }}</td>
                <td>{{ site.da }}</td>
                <td>{{ site.spam_score }}</td>
                <td>{{ site.similarweb_traffic }}</td>
                <td>{{ site.indian_traffic }}</td>
                <td>{{ site.traffic_graph }}</td>
                <td>{{ site.country }}</td>
                <td>{{ site.index_pages }}</td>
                <td>{{ site.hm_score }}</td>
                <td>{{ site.price }}</td>
                <td>{{ site.link_type }}</td>
                <td><span class="edit-icon" onclick="toggleEdit({{ site.id }})">&#9998;</span></td>
            </tr>

            <!-- Edit Row -->
            <tr id="edit-{{ site.id }}" class="edit-form">
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="id" value="{{ site.id }}">
                    <td><input type="text" name="domain" value="{{ site.domain }}" class="form-control"></td>
                    <td><input type="text" name="category" value="{{ site.category }}" class="form-control"></td>
                    <td><input type="number" name="dr" value="{{ site.dr }}" class="form-control"></td>
                    <td><input type="number" name="da" value="{{ site.da }}" class="form-control"></td>
                    <td><input type="text" name="spam_score" value="{{ site.spam_score }}" class="form-control"></td>
                    <td><input type="text" name="similarweb_traffic" value="{{ site.similarweb_traffic }}" class="form-control"></td>
                    <td><input type="text" name="indian_traffic" value="{{ site.indian_traffic }}" class="form-control"></td>
                    <td><input type="text" name="traffic_graph" value="{{ site.traffic_graph }}" class="form-control"></td>
                    <td><input type="text" name="country" value="{{ site.country }}" class="form-control"></td>
                    <td><input type="text" name="index_pages" value="{{ site.index_pages }}" class="form-control"></td>
                    <td><input type="text" name="hm_score" value="{{ site.hm_score }}" class="form-control"></td>
                    <td><input type="text" name="price" value="{{ site.price }}" class="form-control"></td>
                    <td><input type="text" name="link_type" value="{{ site.link_type }}" class="form-control"></td>
                    <td>
                        <button type="submit" class="btn btn-success btn-sm">Save</button>
                    </td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</body>
</html>
